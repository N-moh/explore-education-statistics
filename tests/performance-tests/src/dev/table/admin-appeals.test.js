/* eslint-disable */
import { check } from 'k6';
import http from 'k6/http';
import { htmlReport } from 'https://raw.githubusercontent.com/luke-h1/k6-reporter/main/dist/bundle.js';
import { Rate } from 'k6/metrics';

const username = '';
const password = '';

const BASE_SCHEME = `https://${
  username && password ? `${username}:${password}@` : ''
}`;
const BASE_URL = `${BASE_SCHEME}data.dev.explore-education-statistics.service.gov.uk`;

export const options = {
  noConnectionReuse: true,
  stages: [
    { duration: '600s', target: 10 },
    { duration: '300s', target: 10 },
    { duration: '700s', target: 50 },
    { duration: '800s', target: 10 },
    { duration: '600s', target: 10 },
    { duration: '600s', target: 1 },
  ],
};

export const errorRate = new Rate('errors');

export default function () {
  const data = {
    subjectId: '91f064b4-5434-4a22-04cb-08d8e933abfd',
    indicators: [],
    filters: [],
    locations: {
      localAuthority: [
        'E09000002',
        'E09000003',
        'E08000016',
        'E06000022',
        'E06000055',
        'E09000004',
        'E08000025',
        'E06000008',
        'E06000009',
        'E08000001',
        'E06000028',
        'E06000029',
        'E06000036',
        'E08000032',
        'E09000005',
        'E06000043',
        'E09000006',
        'E10000002',
        'E08000002',
        'E08000033',
        'E06000056',
        'E09000007',
        'E10000003',
        'E06000049',
        'E06000050',
        'E06000023',
        'E06000010',
        'E09000001',
        'E06000018',
        'E06000031',
        'E06000026',
        'E06000052',
        'E08000026',
        'E09000008',
        'E10000006',
        'E06000005',
        'E06000015',
        'E10000007',
        'E10000008',
        'E08000017',
        'E10000009',
        'E10000009',
        'E08000027',
        'E06000047',
        'E09000009',
        'E06000011',
        'E10000011',
        'E09000010',
        'E10000012',
        'E08000020',
        'E10000013',
        'E09000011',
        'E09000012',
        'E06000006',
        'E09000013',
        'E10000014',
        'E09000014',
        'E09000015',
        'E06000001',
        'E09000016',
        'E06000019',
        'E10000015',
        'E09000017',
        'E09000018',
        'E06000046',
        'E06000053',
        'E09000019',
        'E09000020',
        'E10000016',
        'E09000021',
        'E08000034',
        'E08000011',
        'E09000022',
        'E10000017',
        'E08000035',
        'E06000016',
        'E10000018',
        'E09000023',
        'E10000019',
        'E08000012',
        'E06000032',
        'E08000003',
        'E06000035',
        'E09000024',
        'E06000002',
        'E06000042',
        'E08000021',
        'E09000025',
        'E10000020',
        'E06000012',
        'E06000013',
        'E06000024',
        'E08000022',
        'E10000023',
        'E10000021',
        'E06000048',
        'E10000024',
        'E08000004',
        'E10000025',
        'E06000029',
        'E06000044',
        'E06000038',
        'E09000026',
        'E06000003',
        'E09000027',
        'E08000005',
        'E08000018',
        'E06000017',
        'E08000006',
        'E08000028',
        'E08000014',
        'E08000019',
        'E06000051',
        'E06000039',
        'E08000029',
        'E10000027',
        'E06000025',
        'E08000023',
        'E06000045',
        'E06000033',
        'E09000028',
        'E08000013',
        'E10000028',
        'E08000007',
        'E06000004',
        'E06000021',
        'E10000029',
        'E08000024',
        'E10000030',
        'E09000029',
        'E06000030',
        'E08000008',
        'E06000020',
        'E06000034',
        'E06000027',
        'E09000030',
        'E08000009',
        'E08000036',
        'E08000030',
        'E09000031',
        'E09000032',
        'E06000007',
        'E10000031',
        'E06000037',
        'E10000032',
        'E09000033',
        'E08000010',
        'E06000054',
        'E06000040',
        'E08000015',
        'E06000041',
        'E08000031',
        'E10000034',
        'E06000014',
      ],
      country: ['E92000001'],
      region: [
        'E12000004',
        'E12000006',
        'E13000001',
        'E12000007',
        'E12000001',
        'E12000002',
        'E13000002',
        'E12000008',
        'E12000009',
        'E12000005',
        'E12000003',
      ],
    },
    publicationId: 'eac8f6c7-8d03-433b-23f1-08d8c8ff3a5d',
    timePeriod: {
      startYear: 2016,
      startCode: 'RY',
      endYear: 2020,
      endCode: 'RY',
    },
  };

  const res = http.post(`${BASE_URL}/api/tablebuilder`, JSON.stringify(data), {
    headers: { 'Content-Type': 'application/json' },
  });

  console.log('status code is', res.status);
  console.log(`Response time was ${String(res.timings.duration)} ms`);

  check(res, {
    'response code was 200': res => res.status === 200,
  });
}

export function handleSummary(data) {
  return {
    '/tmp/admin-appeals-stages.html': htmlReport(data),
  };
}
